---
import '@styles/global.css';
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';

// Get all brands from the content collection
const brandsCollection = await getCollection('brands');

// The JSON file contains an array of brands, so we get the first entry's data
const brands = Array.isArray(brandsCollection) ? brandsCollection : [];

const sortedBrands = brands.sort((a, b) => (a.data.order || 0) - (b.data.order || 0));
---
<!-- Logos Container -->
<section class="w-full bg-[#FAFAFA] border-b border-gray-3 py-6 lg:py-9 z-1">
    <!-- Logos Wrapper -->
    <div class="relative flex flex-col lg:flex-row justify-center items-center gap-8 lg:gap-auto lg:px-0 lg:pr-10 lg:pl-20">
        <p class="text-center text-xs font-mono text-gray-2">
            MANAGING INFRASTRUCTURE AT
        </p>

        <!-- Div with left and right fade -->
        <div class="relative flex-1 px-0 md:px-20 lg:px-0 overflow-hidden">
            <!-- Left Fade -->
            <div class="pointer-events-none absolute left-0 top-0 h-full w-20 md:w-40 z-10 bg-gradient-to-r from-[#FAFAFA] to-transparent"></div>

            <!-- Right Fade -->
            <div class="pointer-events-none absolute right-0 top-0 h-full w-20 md:w-40 z-10 bg-gradient-to-l from-[#FAFAFA] to-transparent"></div>

            <!-- Brand Logos -->
            <div class="flex animate-marquee items-center justify-start gap-6 px-4 no-scrollbar">
                {[...sortedBrands, ...sortedBrands].map((brand, i) => (
                    <Image src={brand.data.logo} alt={brand.data.alt} class="h-8 flex-shrink-0" />
                ))}
            </div>
        </div>
    </div>
</section>

<style>
    @keyframes marquee-sm {
        0% { transform: translateX(0); }
        100% { transform: translateX(-172%); }
    }

    @keyframes marquee-lg {
        0% { transform: translateX(0); }
        100% { transform: translateX(-140%); }
    }

    @keyframes marquee-xl {
        0% { transform: translateX(0); }
        100% { transform: translateX(-159%); }
    }

    @keyframes marquee-2xl {
        0% { transform: translateX(0); }
        100% { transform: translateX(-112%); }
    }

    .animate-marquee {
        animation: marquee-sm 20s linear infinite;
    }

    /* Tablet */
    @media (min-width: 768px) {
        .animate-marquee {
            animation: marquee-sm 20s linear infinite;
        }
    }

    /* Desktop */
    @media (min-width: 1024px) {
        .animate-marquee {
            animation: marquee-lg 20s linear infinite;
        }
    }

    /* Desktop */
    @media (min-width: 1440px) {
        .animate-marquee {
            animation: marquee-xl 20s linear infinite;
        }
    }

    /* Desktop */
    @media (min-width: 1920px) {
        .animate-marquee {
            animation: marquee-2xl 20s linear infinite;
        }
    }
</style>
